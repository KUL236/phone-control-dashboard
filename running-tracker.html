<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Running Tracker - Real-time GPS</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            padding: 30px;
            max-width: 420px;
            width: 100%;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header .icon {
            font-size: 56px;
            margin-bottom: 15px;
        }

        h1 {
            color: #333;
            font-size: 28px;
            margin-bottom: 8px;
        }

        .subtitle {
            color: #666;
            font-size: 14px;
        }

        /* Stats Display */
        .stats-display {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 25px;
            text-align: center;
            border: 2px solid #e0e0e0;
        }

        .stat-item {
            margin-bottom: 18px;
        }

        .stat-item:last-child {
            margin-bottom: 0;
        }

        .stat-label {
            color: #666;
            font-size: 13px;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 6px;
            font-weight: 600;
        }

        .stat-value {
            font-size: 42px;
            font-weight: bold;
            color: #667eea;
            font-family: 'Courier New', monospace;
            letter-spacing: 2px;
        }

        .stat-value.distance {
            color: #28a745;
        }

        .stat-value.speed {
            color: #ff6b35;
        }

        /* Location Info */
        .location-info {
            background: #d1ecf1;
            border-left: 4px solid #0c5460;
            padding: 12px;
            margin-bottom: 20px;
            border-radius: 4px;
            font-size: 13px;
            color: #0c5460;
        }

        .location-info strong {
            display: block;
            margin-bottom: 6px;
        }

        /* Alert Setup */
        .alert-setup {
            background: #fff3cd;
            border-left: 4px solid #856404;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 8px;
            border: 1px solid #ffeeba;
        }

        .alert-setup h3 {
            color: #856404;
            font-size: 14px;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .alert-input-group {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .alert-input-group input {
            flex: 1;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
            background: white;
        }

        .alert-input-group button {
            padding: 10px 16px;
            background: #856404;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            font-size: 13px;
        }

        .alert-input-group button:hover {
            background: #704b00;
        }

        .alert-status {
            margin-top: 10px;
            padding: 10px;
            background: white;
            border-radius: 4px;
            font-size: 13px;
            color: #333;
            font-weight: 500;
        }

        /* Control Buttons */
        .controls {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 20px;
        }

        .controls.full {
            grid-template-columns: 1fr;
        }

        button {
            padding: 15px;
            font-size: 16px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn-start {
            background: #28a745;
            color: white;
            grid-column: 1 / -1;
        }

        .btn-start:hover:not(:disabled) {
            background: #218838;
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(40, 167, 69, 0.3);
        }

        .btn-pause {
            background: #ffc107;
            color: #333;
        }

        .btn-pause:hover:not(:disabled) {
            background: #e0a800;
            transform: translateY(-2px);
        }

        .btn-resume {
            background: #17a2b8;
            color: white;
        }

        .btn-resume:hover:not(:disabled) {
            background: #138496;
            transform: translateY(-2px);
        }

        .btn-stop {
            background: #dc3545;
            color: white;
        }

        .btn-stop:hover:not(:disabled) {
            background: #c82333;
            transform: translateY(-2px);
        }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Preset Locations */
        .preset-locations {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            justify-content: center;
            margin-bottom: 15px;
        }

        .preset-btn {
            background: #f0f0f0;
            color: #333;
            padding: 8px 12px;
            font-size: 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .preset-btn:hover {
            background: #e0e0e0;
            border-color: #999;
        }

        /* Diagnostics */
        .diagnostics {
            background: #f8f9fa;
            border: 1px solid #ddd;
            border-radius: 6px;
            padding: 12px;
            margin-top: 20px;
            max-height: 120px;
            overflow-y: auto;
            font-size: 11px;
            font-family: monospace;
            color: #333;
        }

        .diagnostics div {
            margin: 3px 0;
            padding: 2px 0;
        }

        .diagnostics .success {
            color: #28a745;
        }

        .diagnostics .error {
            color: #dc3545;
        }

        .diagnostics .info {
            color: #17a2b8;
        }

        /* Status Messages */
        .status {
            padding: 12px;
            margin-bottom: 15px;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 500;
        }

        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .status.error {
            background: #f8d7da;
            color: #842029;
            border: 1px solid #f5c6cb;
        }

        .status.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        .status.loading {
            background: #cfe2ff;
            color: #084298;
            border: 1px solid #b6d4fe;
        }

        /* Gps Badge */
        .gps-badge {
            display: inline-block;
            padding: 6px 10px;
            background: #e8f4f8;
            border: 1px solid #b8dae8;
            border-radius: 16px;
            font-size: 12px;
            color: #0c5460;
            margin-top: 10px;
        }

        .gps-badge.active {
            background: #d4edda;
            border-color: #a8d8a8;
            color: #155724;
        }

        @media (max-width: 480px) {
            .container {
                padding: 20px;
            }

            .stat-value {
                font-size: 36px;
            }

            .controls {
                gap: 8px;
            }

            button {
                padding: 12px;
                font-size: 14px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="icon">üèÉ</div>
            <h1>Running Tracker</h1>
            <p class="subtitle">Real-time GPS running tracker with alerts</p>
        </div>

        <!-- Location Status -->
        <div id="locationStatus" class="status info">
            üìç Attempting to acquire GPS location...
        </div>

        <!-- Stats Display -->
        <div class="stats-display">
            <div class="stat-item">
                <div class="stat-label">‚è±Ô∏è Elapsed Time</div>
                <div class="stat-value" id="timerDisplay">00:00:00</div>
            </div>

            <div class="stat-item">
                <div class="stat-label">üìç Distance</div>
                <div class="stat-value distance" id="distanceDisplay">0.00 km</div>
            </div>

            <div class="stat-item">
                <div class="stat-label">‚ö° Current Speed</div>
                <div class="stat-value speed" id="speedDisplay">0.0 km/h</div>
            </div>
        </div>

        <!-- GPS Info -->
        <div id="gpsInfo" style="display: none;">
            <div class="location-info">
                <strong>üìç Location:</strong>
                <div id="coordsDisplay">Waiting for GPS...</div>
                <div class="gps-badge" id="gpsBadge">üì° Waiting...</div>
            </div>
        </div>

        <!-- Preset Locations -->
        <div class="preset-locations" id="presetContainer" style="display: none;">
            <button class="preset-btn" onclick="usePresetLocation(26.9124, 75.7873)">üìç Jaipur</button>
            <button class="preset-btn" onclick="usePresetLocation(28.7041, 77.1025)">üìç Delhi</button>
            <button class="preset-btn" onclick="usePresetLocation(19.0760, 72.8777)">üìç Mumbai</button>
            <button class="preset-btn" onclick="usePresetLocation(40.7128, -74.0060)">üìç NY</button>
        </div>

        <!-- Alert Setup -->
        <div class="alert-setup">
            <h3>üîî Alert Mode</h3>
            <p style="font-size: 12px; color: #856404; margin-bottom: 12px;">
                Set a target distance. Your phone will vibrate when you reach it!
            </p>
            <div class="alert-input-group">
                <input type="number" id="alertKm" placeholder="Enter km (e.g., 5)" min="0.1" step="0.1" value="">
                <button onclick="setAlertDistance()">‚ö†Ô∏è Set Alert</button>
            </div>
            <div class="alert-status" id="alertStatus" style="display: none;">
                üéØ Alert set for <span id="alertValue">--</span> km
            </div>
        </div>

        <!-- Control Buttons -->
        <div class="controls">
            <button class="btn-start" id="startBtn" onclick="startRun()">üöÄ START RUN</button>
            <button class="btn-pause" id="pauseBtn" onclick="pauseRun()" disabled>‚è∏Ô∏è PAUSE</button>
            <button class="btn-resume" id="resumeBtn" onclick="resumeRun()" disabled style="display: none;">‚ñ∂Ô∏è RESUME</button>
            <button class="btn-stop" id="stopBtn" onclick="stopRun()" disabled>‚èπÔ∏è STOP</button>
        </div>

        <!-- Diagnostics -->
        <div class="diagnostics" id="diagnostics"></div>
    </div>

    <script>
        // ==================== STATE MANAGEMENT ====================
        let runState = {
            isRunning: false,
            isPaused: false,
            startTime: null,
            pausedTime: 0,
            totalPausedDuration: 0,
            lastLocation: null,
            totalDistance: 0,
            currentSpeed: 0,
            maxSpeed: 0,
            locations: [],
            alertDistance: null,
            alertTriggered: false,
            watchId: null
        };

        let currentLocation = null;

        // ==================== INITIALIZATION ====================
        document.addEventListener('DOMContentLoaded', () => {
            log('üöÄ App initialized', 'info');
            requestGPS();
        });

        // ==================== GPS TRACKING ====================
        function requestGPS() {
            if (!navigator.geolocation) {
                updateLocationStatus('‚ùå Geolocation not available', 'error');
                log('‚ùå Geolocation not supported', 'error');
                document.getElementById('presetContainer').style.display = 'flex';
                return;
            }

            updateLocationStatus('üìç Requesting GPS location...', 'loading');

            navigator.geolocation.getCurrentPosition(
                (position) => {
                    currentLocation = {
                        lat: position.coords.latitude,
                        lng: position.coords.longitude,
                        accuracy: position.coords.accuracy
                    };
                    updateLocationStatus(`‚úÖ GPS acquired (¬±${Math.round(position.coords.accuracy)}m)`, 'success');
                    document.getElementById('gpsInfo').style.display = 'block';
                    updateCoordinatesDisplay();
                    log(`üìç GPS: ${currentLocation.lat.toFixed(6)}, ${currentLocation.lng.toFixed(6)}`, 'success');
                },
                (error) => {
                    log(`‚ö†Ô∏è GPS Error: ${error.message}`, 'error');
                    updateLocationStatus('‚ö†Ô∏è GPS not available - use preset locations', 'info');
                    document.getElementById('presetContainer').style.display = 'flex';
                },
                {
                    enableHighAccuracy: true,
                    timeout: 15000,
                    maximumAge: 0
                }
            );
        }

        function startContinuousTracking() {
            if (runState.watchId !== null) {
                navigator.geolocation.clearWatch(runState.watchId);
            }

            runState.watchId = navigator.geolocation.watchPosition(
                (position) => {
                    const newLocation = {
                        lat: position.coords.latitude,
                        lng: position.coords.longitude,
                        accuracy: position.coords.accuracy,
                        timestamp: Date.now()
                    };

                    if (currentLocation) {
                        // Calculate distance using Haversine formula
                        const distance = calculateDistance(currentLocation, newLocation);
                        runState.totalDistance += distance;

                        // Calculate speed
                        if (runState.lastLocation && runState.lastLocation.timestamp) {
                    let distance = 0;
                    if (currentLocation) {
                        distance = calculateDistance(currentLocation, newLocation);
                        // only accumulate distance while running
                        if (runState.isRunning) {
                            runState.totalDistance += distance;
                        }

                        // Calculate speed using previous timestamp when available
                        if (runState.lastLocation && runState.lastLocation.timestamp) {
                            const timeDiffSeconds = (newLocation.timestamp - runState.lastLocation.timestamp) / 1000;
                            if (timeDiffSeconds > 0) {
                                const speedKmh = (distance / timeDiffSeconds) * 3.6;
                                if (speedKmh > 0 && speedKmh < 50) {
                                    runState.currentSpeed = speedKmh;
                                    runState.maxSpeed = Math.max(runState.maxSpeed, speedKmh);
                                }
                            }
                        }

                    // Check alert distance
                    checkAlertDistance();

                    log(`üìç Updated: ${distance.toFixed(3)}km | Total: ${runState.totalDistance.toFixed(2)}km`, 'info');
                },
                (error) => {
                    log(`‚ö†Ô∏è Watch error: ${error.message}`, 'error');
                },
                {
                    enableHighAccuracy: true,
                    maximumAge: 0,
                    log(`üìç Updated: ${distance.toFixed(3)}km | Total: ${runState.totalDistance.toFixed(2)}km`, 'info');
                }
            );
        }

        function stopContinuousTracking() {
            if (runState.watchId !== null) {
                navigator.geolocation.clearWatch(runState.watchId);
                runState.watchId = null;
            }
        }

        // ==================== RUNNING CONTROLS ====================
        function startRun() {
            if (!currentLocation) {
                showAlert('‚ùå Please select a location first', 'error');
                return;
            }

            runState.isRunning = true;
            runState.isPaused = false;
            runState.startTime = Date.now() - runState.totalPausedDuration;
            // Seed lastLocation with current GPS fix to avoid a large first jump
            if (currentLocation) {
                runState.lastLocation = {
                    lat: currentLocation.lat,
                    lng: currentLocation.lng,
                    accuracy: currentLocation.accuracy || 0,
                    timestamp: Date.now()
                };
            } else {
                runState.lastLocation = null;
            }
            runState.totalDistance = 0;
            runState.currentSpeed = 0;
            runState.maxSpeed = 0;
            runState.locations = [];
            runState.alertTriggered = false;

            log('üöÄ RUN STARTED', 'success');
            updateButtonStates();
            startContinuousTracking();
            startTimer();
            updateDisplay();
        }

        function pauseRun() {
            if (!runState.isRunning) return;

            runState.isRunning = false;
            runState.isPaused = true;
            runState.pausedTime = Date.now();
            stopContinuousTracking();

            log('‚è∏Ô∏è  RUN PAUSED', 'info');
            updateButtonStates();
        }

        function resumeRun() {
            if (!runState.isPaused) return;

            runState.totalPausedDuration += Date.now() - runState.pausedTime;
            runState.isRunning = true;
            runState.isPaused = false;

            log('‚ñ∂Ô∏è  RUN RESUMED', 'success');
            updateButtonStates();
            startContinuousTracking();
            startTimer();
        }

        function stopRun() {
            stopContinuousTracking();
            runState.isRunning = false;
            runState.isPaused = false;

            log('‚èπÔ∏è  RUN STOPPED', 'success');
            log(`üìä Final: ${runState.totalDistance.toFixed(2)}km | Max Speed: ${runState.maxSpeed.toFixed(1)}km/h`, 'success');
            updateButtonStates();
        }

        // ==================== TIMER ====================
        let timerInterval = null;

        function startTimer() {
            if (timerInterval) clearInterval(timerInterval);

            timerInterval = setInterval(() => {
                if (runState.isRunning) {
                    updateDisplay();
                }
            }, 1000);
        }

        function getElapsedTime() {
            if (!runState.startTime) return 0;
            return Math.floor((Date.now() - runState.startTime) / 1000);
        }

        function formatTime(seconds) {
            const hours = Math.floor(seconds / 3600);
            const minutes = Math.floor((seconds % 3600) / 60);
            const secs = seconds % 60;
            return `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;
        }

        // ==================== ALERT SYSTEM ====================
        function setAlertDistance() {
            const km = parseFloat(document.getElementById('alertKm').value);
            if (isNaN(km) || km <= 0) {
                showAlert('‚ùå Enter a valid distance', 'error');
                return;
            }

            runState.alertDistance = km;
            runState.alertTriggered = false;
            document.getElementById('alertStatus').style.display = 'block';
            document.getElementById('alertValue').textContent = km.toFixed(1);
            log(`‚ö†Ô∏è Alert set for ${km.toFixed(1)}km`, 'success');
        }

        function checkAlertDistance() {
            if (!runState.alertDistance || runState.alertTriggered) return;

            if (runState.totalDistance >= runState.alertDistance) {
                triggerAlert();
            }
        }

        function triggerAlert() {
            runState.alertTriggered = true;
            log(`üéâ ALERT! Reached ${runState.alertDistance}km! üéâ`, 'success');

            // Vibration pattern: long, short, long
            if (navigator.vibrate) {
                navigator.vibrate([200, 100, 200, 100, 300]);
            }

            // Visual alert
            showAlert(`üéâ YOU'VE REACHED ${runState.alertDistance.toFixed(1)}km! üéâ`, 'success');

            // Sound alert
            playAlertSound();
        }

        function playAlertSound() {
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();

                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);

                oscillator.frequency.value = 800;
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);

                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.5);
            } catch (e) {
                console.log('Audio not available');
            }
        }

        // ==================== DISPLAY UPDATES ====================
        function updateDisplay() {
            const elapsed = getElapsedTime();
            document.getElementById('timerDisplay').textContent = formatTime(elapsed);
            document.getElementById('distanceDisplay').textContent = `${runState.totalDistance.toFixed(2)} km`;
            document.getElementById('speedDisplay').textContent = `${runState.currentSpeed.toFixed(1)} km/h`;
        }

        function updateCoordinatesDisplay() {
            if (!currentLocation) return;
            document.getElementById('coordsDisplay').textContent =
                `${currentLocation.lat.toFixed(6)}, ${currentLocation.lng.toFixed(6)}`;
            document.getElementById('gpsBadge').textContent = 'üì° Active (GPS)';
            document.getElementById('gpsBadge').classList.add('active');
        }

        function updateLocationStatus(message, type) {
            const statusEl = document.getElementById('locationStatus');
            statusEl.textContent = message;
            statusEl.className = `status ${type}`;
        }

        function updateButtonStates() {
            const startBtn = document.getElementById('startBtn');
            const pauseBtn = document.getElementById('pauseBtn');
            const resumeBtn = document.getElementById('resumeBtn');
            const stopBtn = document.getElementById('stopBtn');

            if (runState.isRunning) {
                startBtn.disabled = true;
                pauseBtn.disabled = false;
                resumeBtn.style.display = 'none';
                resumeBtn.disabled = true;
                stopBtn.disabled = false;
            } else if (runState.isPaused) {
                startBtn.disabled = true;
                pauseBtn.disabled = true;
                resumeBtn.style.display = 'block';
                resumeBtn.disabled = false;
                stopBtn.disabled = false;
            } else {
                startBtn.disabled = false;
                pauseBtn.disabled = true;
                resumeBtn.style.display = 'none';
                resumeBtn.disabled = true;
                stopBtn.disabled = true;
            }
        }

        // ==================== LOCATION HELPERS ====================
        function usePresetLocation(lat, lng) {
            currentLocation = {
                lat: lat,
                lng: lng,
                accuracy: 50
            };
            updateLocationStatus('‚úÖ Location set manually', 'success');
            document.getElementById('gpsInfo').style.display = 'block';
            updateCoordinatesDisplay();
            log(`üìç Preset location set: ${lat.toFixed(4)}, ${lng.toFixed(4)}`, 'success');
        }

        function calculateDistance(loc1, loc2) {
            const R = 6371; // Earth radius in km
            const dLat = (loc2.lat - loc1.lat) * (Math.PI / 180);
            const dLon = (loc2.lng - loc1.lng) * (Math.PI / 180);
            const a =
                Math.sin(dLat / 2) * Math.sin(dLat / 2) +
                Math.cos(loc1.lat * (Math.PI / 180)) *
                Math.cos(loc2.lat * (Math.PI / 180)) *
                Math.sin(dLon / 2) * Math.sin(dLon / 2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
            return R * c;
        }

        // ==================== UTILITY FUNCTIONS ====================
        function log(message, type = 'info') {
            console.log(message);
            const diagEl = document.getElementById('diagnostics');
            const div = document.createElement('div');
            div.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            if (type) div.className = type;
            diagEl.appendChild(div);

            // Keep only last 10 lines
            while (diagEl.children.length > 10) {
                diagEl.removeChild(diagEl.firstChild);
            }
        }

        function showAlert(message, type = 'info') {
            const statusEl = document.getElementById('locationStatus');
            const tempClass = statusEl.className;
            statusEl.textContent = message;
            statusEl.className = `status ${type}`;

            setTimeout(() => {
                statusEl.className = tempClass;
                updateLocationStatus('Ready', 'success');
            }, 3000);
        }
    </script>
</body>
</html>
